<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <link rel="alternate" type="application/atom+xml" title="Atom Feed"  href="https://btbytes.github.io/atom.xml" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>index</title>
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
<nav>
  <span><a href="index.html" title="Home">Home</a></span> ◊ <span><a href="index.html#tags">Tags</a></span> ◊ <span><a href="index.html#archive">Archive</a></span> ◊ <span><a href="/atom.xml">Feed</a></span>
</nav>
<article>

<div class="post">
<p><date>2020-05-07</date> <a href="2020-05-07-02-code-in-books.html">My code in books</a></p>
<p>During a “vanity search” of this blog “btbytes.github.io”, I found out that some of my code have been quoted in published books:</p>
<p>(<a href="https://gist.github.com/btbytes/79877">A Particle Swarm Optimization</a>) implementation in Python in <a href="https://www.packtpub.com/hardware-and-creative/intelligent-iot-projects-7-days">“Intelligent IoT Projects in 7 Days”</a>. I remember writing this code for Dr Eberhart’s “Computation Intelligence” class at IUPUI.</p>
<p><img src="images/pso-book.png" /></p>
<p>The code in question:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1"></a><span class="co">#!/usr/bin/env python</span></span>
<span id="cb1-2"><a href="#cb1-2"></a></span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="co">&#39;&#39;&#39;</span></span>
<span id="cb1-4"><a href="#cb1-4"></a><span class="co">pso.py</span></span>
<span id="cb1-5"><a href="#cb1-5"></a></span>
<span id="cb1-6"><a href="#cb1-6"></a><span class="co">A simple implementation of the Particle Swarm Optimisation Algorithm.</span></span>
<span id="cb1-7"><a href="#cb1-7"></a><span class="co">Uses Numpy for matrix operations.</span></span>
<span id="cb1-8"><a href="#cb1-8"></a><span class="co">Pradeep Gowda 2009-03-16</span></span>
<span id="cb1-9"><a href="#cb1-9"></a><span class="co">&#39;&#39;&#39;</span></span>
<span id="cb1-10"><a href="#cb1-10"></a></span>
<span id="cb1-11"><a href="#cb1-11"></a><span class="im">from</span> numpy <span class="im">import</span> array</span>
<span id="cb1-12"><a href="#cb1-12"></a><span class="im">from</span> random <span class="im">import</span> random</span>
<span id="cb1-13"><a href="#cb1-13"></a><span class="im">from</span> math <span class="im">import</span> sin, sqrt</span>
<span id="cb1-14"><a href="#cb1-14"></a></span>
<span id="cb1-15"><a href="#cb1-15"></a>iter_max <span class="op">=</span> <span class="dv">10000</span></span>
<span id="cb1-16"><a href="#cb1-16"></a>pop_size <span class="op">=</span> <span class="dv">100</span></span>
<span id="cb1-17"><a href="#cb1-17"></a>dimensions <span class="op">=</span> <span class="dv">2</span></span>
<span id="cb1-18"><a href="#cb1-18"></a>c1 <span class="op">=</span> <span class="dv">2</span></span>
<span id="cb1-19"><a href="#cb1-19"></a>c2 <span class="op">=</span> <span class="dv">2</span></span>
<span id="cb1-20"><a href="#cb1-20"></a>err_crit <span class="op">=</span> <span class="fl">0.00001</span></span>
<span id="cb1-21"><a href="#cb1-21"></a></span>
<span id="cb1-22"><a href="#cb1-22"></a><span class="kw">class</span> Particle:</span>
<span id="cb1-23"><a href="#cb1-23"></a>    <span class="cf">pass</span></span>
<span id="cb1-24"><a href="#cb1-24"></a></span>
<span id="cb1-25"><a href="#cb1-25"></a><span class="kw">def</span> f6(param):</span>
<span id="cb1-26"><a href="#cb1-26"></a>    <span class="co">&#39;&#39;&#39;Schaffer&#39;s F6 function&#39;&#39;&#39;</span></span>
<span id="cb1-27"><a href="#cb1-27"></a>    para <span class="op">=</span> param<span class="op">*</span><span class="dv">10</span></span>
<span id="cb1-28"><a href="#cb1-28"></a>    para <span class="op">=</span> param[<span class="dv">0</span>:<span class="dv">2</span>]</span>
<span id="cb1-29"><a href="#cb1-29"></a>    num <span class="op">=</span> (sin(sqrt((para[<span class="dv">0</span>] <span class="op">*</span> para[<span class="dv">0</span>]) <span class="op">+</span> (para[<span class="dv">1</span>] <span class="op">*</span> para[<span class="dv">1</span>])))) <span class="op">*</span> <span class="op">\</span></span>
<span id="cb1-30"><a href="#cb1-30"></a>        (sin(sqrt((para[<span class="dv">0</span>] <span class="op">*</span> para[<span class="dv">0</span>]) <span class="op">+</span> (para[<span class="dv">1</span>] <span class="op">*</span> para[<span class="dv">1</span>])))) <span class="op">-</span> <span class="fl">0.5</span></span>
<span id="cb1-31"><a href="#cb1-31"></a>    denom <span class="op">=</span> (<span class="fl">1.0</span> <span class="op">+</span> <span class="fl">0.001</span> <span class="op">*</span> ((para[<span class="dv">0</span>] <span class="op">*</span> para[<span class="dv">0</span>]) <span class="op">+</span> (para[<span class="dv">1</span>] <span class="op">*</span> para[<span class="dv">1</span>]))) <span class="op">*</span> <span class="op">\</span></span>
<span id="cb1-32"><a href="#cb1-32"></a>            (<span class="fl">1.0</span> <span class="op">+</span> <span class="fl">0.001</span> <span class="op">*</span> ((para[<span class="dv">0</span>] <span class="op">*</span> para[<span class="dv">0</span>]) <span class="op">+</span> (para[<span class="dv">1</span>] <span class="op">*</span> para[<span class="dv">1</span>])))</span>
<span id="cb1-33"><a href="#cb1-33"></a>    f6 <span class="op">=</span>  <span class="fl">0.5</span> <span class="op">-</span> (num<span class="op">/</span>denom)</span>
<span id="cb1-34"><a href="#cb1-34"></a>    errorf6 <span class="op">=</span> <span class="dv">1</span> <span class="op">-</span> f6</span>
<span id="cb1-35"><a href="#cb1-35"></a>    <span class="cf">return</span> f6, errorf6<span class="op">;</span></span>
<span id="cb1-36"><a href="#cb1-36"></a></span>
<span id="cb1-37"><a href="#cb1-37"></a></span>
<span id="cb1-38"><a href="#cb1-38"></a><span class="co">#initialize the particles</span></span>
<span id="cb1-39"><a href="#cb1-39"></a>particles <span class="op">=</span> []</span>
<span id="cb1-40"><a href="#cb1-40"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(pop_size):</span>
<span id="cb1-41"><a href="#cb1-41"></a>    p <span class="op">=</span> Particle()</span>
<span id="cb1-42"><a href="#cb1-42"></a>    p.params <span class="op">=</span> array([random() <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(dimensions)])</span>
<span id="cb1-43"><a href="#cb1-43"></a>    p.fitness <span class="op">=</span> <span class="fl">0.0</span></span>
<span id="cb1-44"><a href="#cb1-44"></a>    p.v <span class="op">=</span> <span class="fl">0.0</span></span>
<span id="cb1-45"><a href="#cb1-45"></a>    particles.append(p)</span>
<span id="cb1-46"><a href="#cb1-46"></a></span>
<span id="cb1-47"><a href="#cb1-47"></a><span class="co"># let the first particle be the global best</span></span>
<span id="cb1-48"><a href="#cb1-48"></a>gbest <span class="op">=</span> particles[<span class="dv">0</span>]</span>
<span id="cb1-49"><a href="#cb1-49"></a>err <span class="op">=</span> <span class="dv">999999999</span></span>
<span id="cb1-50"><a href="#cb1-50"></a><span class="cf">while</span> i <span class="op">&lt;</span> iter_max :</span>
<span id="cb1-51"><a href="#cb1-51"></a>    <span class="cf">for</span> p <span class="kw">in</span> particles:</span>
<span id="cb1-52"><a href="#cb1-52"></a>        fitness,err <span class="op">=</span> f6(p.params)</span>
<span id="cb1-53"><a href="#cb1-53"></a>        <span class="cf">if</span> fitness <span class="op">&gt;</span> p.fitness:</span>
<span id="cb1-54"><a href="#cb1-54"></a>            p.fitness <span class="op">=</span> fitness</span>
<span id="cb1-55"><a href="#cb1-55"></a>            p.best <span class="op">=</span> p.params</span>
<span id="cb1-56"><a href="#cb1-56"></a></span>
<span id="cb1-57"><a href="#cb1-57"></a>        <span class="cf">if</span> fitness <span class="op">&gt;</span> gbest.fitness:</span>
<span id="cb1-58"><a href="#cb1-58"></a>            gbest <span class="op">=</span> p</span>
<span id="cb1-59"><a href="#cb1-59"></a>        v <span class="op">=</span> p.v <span class="op">+</span> c1 <span class="op">*</span> random() <span class="op">*</span> (p.best <span class="op">-</span> p.params) <span class="op">\</span></span>
<span id="cb1-60"><a href="#cb1-60"></a>                <span class="op">+</span> c2 <span class="op">*</span> random() <span class="op">*</span> (gbest.params <span class="op">-</span> p.params)</span>
<span id="cb1-61"><a href="#cb1-61"></a>        p.params <span class="op">=</span> p.params <span class="op">+</span> v</span>
<span id="cb1-62"><a href="#cb1-62"></a></span>
<span id="cb1-63"><a href="#cb1-63"></a>    i  <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb1-64"><a href="#cb1-64"></a>    <span class="cf">if</span> err <span class="op">&lt;</span> err_crit:</span>
<span id="cb1-65"><a href="#cb1-65"></a>        <span class="cf">break</span></span>
<span id="cb1-66"><a href="#cb1-66"></a>    <span class="co">#progress bar. &#39;.&#39; = 10%</span></span>
<span id="cb1-67"><a href="#cb1-67"></a>    <span class="cf">if</span> i <span class="op">%</span> (iter_max<span class="op">/</span><span class="dv">10</span>) <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb1-68"><a href="#cb1-68"></a>        <span class="bu">print</span> <span class="st">&#39;.&#39;</span></span>
<span id="cb1-69"><a href="#cb1-69"></a></span>
<span id="cb1-70"><a href="#cb1-70"></a><span class="bu">print</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">Particle Swarm Optimisation</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb1-71"><a href="#cb1-71"></a><span class="bu">print</span> <span class="st">&#39;PARAMETERS</span><span class="ch">\n</span><span class="st">&#39;</span>,<span class="st">&#39;-&#39;</span><span class="op">*</span><span class="dv">9</span></span>
<span id="cb1-72"><a href="#cb1-72"></a><span class="bu">print</span> <span class="st">&#39;Population size : &#39;</span>, pop_size</span>
<span id="cb1-73"><a href="#cb1-73"></a><span class="bu">print</span> <span class="st">&#39;Dimensions      : &#39;</span>, dimensions</span>
<span id="cb1-74"><a href="#cb1-74"></a><span class="bu">print</span> <span class="st">&#39;Error Criterion : &#39;</span>, err_crit</span>
<span id="cb1-75"><a href="#cb1-75"></a><span class="bu">print</span> <span class="st">&#39;c1              : &#39;</span>, c1</span>
<span id="cb1-76"><a href="#cb1-76"></a><span class="bu">print</span> <span class="st">&#39;c2              : &#39;</span>, c2</span>
<span id="cb1-77"><a href="#cb1-77"></a><span class="bu">print</span> <span class="st">&#39;function        :  f6&#39;</span></span>
<span id="cb1-78"><a href="#cb1-78"></a></span>
<span id="cb1-79"><a href="#cb1-79"></a><span class="bu">print</span> <span class="st">&#39;RESULTS</span><span class="ch">\n</span><span class="st">&#39;</span>, <span class="st">&#39;-&#39;</span><span class="op">*</span><span class="dv">7</span></span>
<span id="cb1-80"><a href="#cb1-80"></a><span class="bu">print</span> <span class="st">&#39;gbest fitness   : &#39;</span>, gbest.fitness</span>
<span id="cb1-81"><a href="#cb1-81"></a><span class="bu">print</span> <span class="st">&#39;gbest params    : &#39;</span>, gbest.params</span>
<span id="cb1-82"><a href="#cb1-82"></a><span class="bu">print</span> <span class="st">&#39;iterations      : &#39;</span>, i<span class="op">+</span><span class="dv">1</span></span>
<span id="cb1-83"><a href="#cb1-83"></a><span class="co">## Uncomment to print particles</span></span>
<span id="cb1-84"><a href="#cb1-84"></a><span class="co">#for p in particles:</span></span>
<span id="cb1-85"><a href="#cb1-85"></a><span class="co">#    print &#39;params: %s, fitness: %s, best: %s&#39; % (p.params, p.fitness, p.best)</span></span></code></pre></div>
<p>That’s in Python2.x. Should probably rewrite it in Python3 one of these days.</p>
<hr />
<p>A link to my <a href="http://btbytes.github.io/pyofc2/">PyOFC2</a> Python charting library in <a href="https://books.google.com/books?id=RHBWBQAAQBAJ&amp;lpg=PA46&amp;ots=K3Ax-hLlZg&amp;dq=btbytes.github.io&amp;pg=PA46#v=onepage&amp;q=btbytes.github.io&amp;f=false">“Building a Cloud Computing Service: An Introduction to the Cloud”</a>.</p>
<p><img src="images/pyofc2-book.png" /></p>
<p><a href="index.html#programming" class="tag programming">programming</a></p>
</div>
<div class="post">
<p><date>2020-05-06</date> <a href="2020-05-06-06-happy-python.html">My Happy Python Workflow</a></p>
<p>This is my current python programming workflow. I’m quite happy with it. I constantly try to get better.</p>
<ol type="1">
<li>I use Python3.x for all new projects.</li>
<li>I use SublimeText3(ST3) for editing.</li>
<li>I use Two ST3 plugins – <code>Anaconda</code> and <code>PyYapf</code>.</li>
<li>Anaconda catches things like unused variables, syntax errors, and PEP8 violations.</li>
<li>I use PyYAPF formatting compulsively.</li>
<li>..and “Highlight Trailing Whitespace”, I find trailing whitespace unpleasant.</li>
<li>I take PEP8 warnings seriously and try to keep <code>pyflakes</code> happy.</li>
<li>Vim in the shell. No plugins.</li>
<li>Start with a <code>README.md</code> in the project, even if it is a single file project.</li>
<li>I always use <code>virtualenv</code>; Pipenv is a quick way to spin one up in the development environments.</li>
<li>Always capture the dependencies in <code>requirements.txt</code>, unless I’m writing a setup.py</li>
<li>Writing a <code>setup.py</code> file is a great idea, and I should do it more often.</li>
<li>I always write a <code>Makefile</code>.</li>
<li>For Python projects, the common “targets” are – <code>deps</code> (for creating venvs and installing package dependencies), <code>package</code> (for packaging into tarballs and wheels) and <code>test</code> to run the test suite.</li>
<li>The <code>Makefile</code> serves as contextual memory.</li>
<li>For “scripting” applications, I like to avoid using third party libraries as much as possible and keep to the standard library.</li>
<li>I like providing a CLI interface to my scripts; I use <code>argparse</code> often, even if it is to provide basic <code>--help</code>.</li>
<li><code>click</code> looks neat, and I can see using it more often for larger projects.</li>
<li><code>docopt</code> has fallen out of favour. Too fidgety for my taste.</li>
<li>I tried <code>python-poetry</code> for one project, and I like what it does.</li>
<li>I like putting package versions in my <code>setup.py</code> files. I don’t know if “Semantic versioning” is still a thing, but I like the x.y.z format, so I’m sticking to it.</li>
<li>Any program that is big enough to have a setup.py file will also have CLI entry_points.</li>
<li>I prefer writing small, self contained functions.</li>
<li>I wouldn’t write a class unless I feel like I’m passing around too many variables between functions.</li>
<li>I like putting unit testing in the same file as the code, if it’s a single file program.</li>
<li>doc tests seemed like a good idea, but unit tests are a good way to grow the tests without redoing the doc tests.</li>
<li>I have started writing type annotations, though nowhere near where I could be.</li>
<li>I <em>love</em> <code>f-strings</code>. I never seemed to remember the right way to call format strings before I got used to <code>f-strings</code>, though <code>.format</code> came earlier.</li>
<li>I don’t like long variable names, especially ones with <code>camelCase</code>; <code>snake_case</code> for me please.</li>
<li>I use single character variable names when their meaning is clear from the context.</li>
<li>I seldom read code without rewriting some parts of it. Many times the changes do become pull requests.</li>
<li>I don’t like commented out code in middle of programs.</li>
<li>I’m still not good with the <code>async</code> stuff.</li>
<li>I prefer using multiprocessing over threads. I don’t remember the last time I wrote Python threading code.</li>
<li>I’m team single-quotes ’. I like when my string look like – <code>'hello, world!'</code> instead of <code>"hello, world!"</code>.</li>
<li>I haven’t used the walrus operator yet.</li>
<li>I always write “dunder main”(<code>__main__</code>), unless its a throw away script (or a would’ve-been-a-bash-script script).</li>
<li>You won’t catch me manipulating “path” to insert dependent library locations. I know how to use packages and virtualenvs.</li>
<li>4 spaces. No TABs characters in my programs. I do use the TAB key to tell the editor to indent appropriately.</li>
</ol>
<p><a href="index.html#python" class="tag python">python</a></p>
</div>
<div class="post">
<p><date>2020-05-06</date> <a href="2020-05-06-04-codespaces.html">github codespaces</a></p>
<p>The announcement of github <a href="https://github.com/features/codespaces">Codespaces</a> made me think of why I almost always default to programming in Python. One is definitely familiarity. But, I think the bigger issue (for me, at least) is that the default Python I have on most machines I work on is sufficient enough to be productive right away.</p>
<p>I use sublime text for editing python, which is quite fast to startup and the two python plugins – anaconda and PyYAPF is sufficient for me to be very productive with Python.</p>
<p>There are a ton of languages that I’d like to try to build my programming muscles over time by writing small programs, but this “goldilocks” environment has prevented from doing so.</p>
<p>I hope things like github codespaces can allow me capture the “works great for me setup” in a config file(s), and thus allow me to jump into a project quickly and start coding away and not worry about the right language version (ruby), right interpreter (javascript), right “module” setup (go), right standard library(OCaml), easy to install libraries (haskell) etc.,</p>
<p><a href="index.html#programming" class="tag programming">programming</a></p>
</div>
<div class="post">
<p><date>2020-05-05</date> <a href="2020-05-05-02-bari.html">Just-what-you-need blogging with bari</a></p>
<p>I write this blog using a combination of <code>pandoc</code>, <code>make</code> and a small-ish python script called <a href="https://github.com/btbytes/bari">bari</a>.</p>
<p>It is easy for me to design, write and maintain my own code than inherit someone else’s assumptions and “wants” for their software.</p>
<p>I saw another blog <a href="https://blog.notryan.com/">https://blog.notryan.com/</a> that is also written in a similar spirit – uses only C, and a bash script to generate a “text only” blog and RSS feed.</p>
<p>So, go on, write your own little program(s) to do what you need to get writing. Some of it is yak-shaving; but some yaks are small, some of you are expert shavers. You will figure it out.</p>
</div>
<div class="post">
<p><date>2020-05-05</date> <a href="2020-05-05-01-golang-hash-builds.html">Building Go Programs with Source File Hash baked in</a></p>
<p>Imagine a scenario where you are trying to replace a script written in Bash with Go. Lets assume for the sake of this disucssion the following:</p>
<ol type="1">
<li>This program is longer than what you are comfortable maintaining in Bash/Perl/Python</li>
<li>This program has library dependencies</li>
<li>The target deployment system does not have a “devops” setup to install required dependencies (or has an older version of the OS)</li>
<li>The script does not change often</li>
<li>The “deployment” consists of copying/syncing/<code>git pull</code> script into the target machine.</li>
<li>The target system does not have a golang compiler</li>
</ol>
<p>Writing the “scripts” that fit the above criteria in Go looks like a win. You get:</p>
<ol type="1">
<li>static typing, and developer productivity tooling &amp; apparatus</li>
<li>single deployable binary (that you can commit along with the source)</li>
<li>dependencies baked in</li>
</ol>
<p>The one issue with checking in the binary with source code is, you can’t be sure if the binary is built with the latest source that is adjacent to it.</p>
<p>Essentially, this is what we want to have:</p>
<pre><code>$ sha256sum hello.go
0246c2bce7473e5c02e8ef510ff89e7ef5aedf74ffb7df66cdb19acb433d24aa  hello.go</code></pre>
<p>The <code>sha256sum</code> of the source file is - <code>0246c2bce7473e5c02e8ef510ff89e7ef5aedf74ffb7df66cdb19acb433d24aa</code>.</p>
<p>Let’s say we have a binary <code>hello</code>, that is adjacent to this source file, that we assume to be compiled from this source file.</p>
<p>What if we could verify that?</p>
<pre><code>$ ./hello -v
0246c2bce7473e5c02e8ef510ff89e7ef5aedf74ffb7df66cdb19acb433d24aa</code></pre>
<p>If the program prints the same hash, we can assume that they match.</p>
<p>What if there was a way to “bake-in” the hash of the source file into the binary? We can.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb4-1"><a href="#cb4-1"></a><span class="co">// hello.go</span></span>
<span id="cb4-2"><a href="#cb4-2"></a><span class="kw">package</span> main</span>
<span id="cb4-3"><a href="#cb4-3"></a></span>
<span id="cb4-4"><a href="#cb4-4"></a><span class="kw">import</span> (</span>
<span id="cb4-5"><a href="#cb4-5"></a>        <span class="st">&quot;fmt&quot;</span></span>
<span id="cb4-6"><a href="#cb4-6"></a>)</span>
<span id="cb4-7"><a href="#cb4-7"></a></span>
<span id="cb4-8"><a href="#cb4-8"></a><span class="kw">var</span> sourcehash <span class="dt">string</span></span>
<span id="cb4-9"><a href="#cb4-9"></a></span>
<span id="cb4-10"><a href="#cb4-10"></a><span class="kw">func</span> main() {</span>
<span id="cb4-11"><a href="#cb4-11"></a>        fmt.Println(sourcehash)</span>
<span id="cb4-12"><a href="#cb4-12"></a>}</span></code></pre></div>
<p>Build step:</p>
<pre><code>$ export SOURCEHASH=`sha256sum hello.go | cut -d&#39; &#39; -f1`
$ go build -ldflags &quot;-X main.sourcehash=$SOURCEHASH&quot;</code></pre>
<p>Verify:</p>
<pre><code>$ ./hello
7fffa4353f81b58c682e5b33ec7d720cc6db8e469a10d6fc5f31e11eafaa9104</code></pre>
<p>NOTE: there is nothing stopping you from passing in any value to <code>-ldflags</code>. This meant to be in an environment where you have complete control of the source, binary and the build process, and you are adding something to the build output to help you later on (in case of a doubt).</p>
<p>I was wondering if I could do this and <a href="https://stackoverflow.com/a/28460195">found the answer on SO</a>.</p>
<p><a href="index.html#golang" class="tag golang">golang</a></p>
</div>
<h2 id="archive">Archive</h2>
<h3 id="section">2020</h3>
<p><date>2020-05-02</date> <a href="2020-05-02-01-quip.html">Quip</a></p>
<p><date>2020-05-01</date> <a href="2020-05-01-01-interest-calculation.html">A worked exmaple of - A persian folk method of figuring interest</a></p>
<p><date>2020-04-29</date> <a href="2020-04-29-pipx.html">pipx is like brew for python applications</a></p>
<p><date>2020-04-29</date> <a href="2020-04-29-courier.html">Courier is a nice monospace font</a></p>
<p><date>2020-04-29</date> <a href="2020-04-29-conwayslaw.html">Conway’s law</a></p>
<h2 id="tags">Tags</h2>
<p><span id="computing" class="tagged">computing</span>: ◊<a href="2020-04-29-conwayslaw.html">Conway’s law</a></p>
<p><span id="fonts" class="tagged">fonts</span>: ◊<a href="2020-04-29-courier.html">Courier is a nice monospace font</a></p>
<p><span id="golang" class="tagged">golang</span>: ◊<a href="2020-05-05-01-golang-hash-builds.html">Building Go Programs with Source File Hash baked in</a></p>
<p><span id="mathematics" class="tagged">mathematics</span>: ◊<a href="2020-05-01-01-interest-calculation.html">A worked exmaple of - A persian folk method of figuring interest</a></p>
<p><span id="programming" class="tagged">programming</span>: ◊<a href="2020-05-06-04-codespaces.html">github codespaces</a> ◊<a href="2020-05-07-02-code-in-books.html">My code in books</a></p>
<p><span id="python" class="tagged">python</span>: ◊<a href="2020-04-29-pipx.html">pipx is like brew for python applications</a> ◊<a href="2020-05-06-06-happy-python.html">My Happy Python Workflow</a></p>
<p><span id="software" class="tagged">software</span>: ◊<a href="2020-05-02-01-quip.html">Quip</a></p>
</article>
<footer>
  <p>Made with <a href="https://github.com/btbytes/bari">bari</a> with help from <a href="https://pandoc.org">pandoc</a>, <a href="https://www.gnu.org/software/make/">make</a> and <a href="https://www.python.org">python</a> </p>
</footer>
<script data-goatcounter="https://btbytes-github.goatcounter.com/count" async src="//gc.zgo.at/count.js"></script>
</body>
</html>
